<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï†ïÎ∞Ä Í≥ÑÏÇ∞Í∏∞ & Îß§Í∞úÎ≥ÄÏàò Í∑∏ÎûòÌîÑ</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; text-align: center; background-color: #f0f2f5; margin: 20px; }
        .calculator { display: inline-block; padding: 25px; border-radius: 20px; background: #ffffff; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 450px; }
        #display { 
            width: 100%; min-height: 80px; font-size: 20px; margin-bottom: 20px; 
            text-align: left; padding: 15px; border: 2px solid #eee; border-radius: 12px; 
            background: #fafafa; word-break: break-all; overflow-y: auto; box-sizing: border-box;
            display: block; outline: none;
        }
        .buttons { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        button { padding: 15px 5px; font-size: 15px; cursor: pointer; border: none; border-radius: 10px; background: #e9ecef; transition: 0.2s; font-weight: 500; }
        button:hover { background: #dee2e6; transform: translateY(-2px); }
        .equal { background: #ff9500; color: white; }
        .clear { background: #ff3b30; color: white; }
        .delete { background: #495057; color: white; }
        .var-btn { background: #007bff; color: white; font-weight: bold; }
        .var-btn:hover { background: #0056b3; }
        canvas { border: 1px solid #333; background: #fff; cursor: grab; border-radius: 15px; margin-top: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .result { font-size: 20px; margin-top: 15px; font-weight: bold; color: #343a40; }
        
        /* r Ïä¨ÎùºÏù¥Îçî Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä */
        .controls { margin-top: 20px; background: #fff; padding: 15px; border-radius: 15px; display: inline-block; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .controls label { font-weight: bold; margin-right: 10px; }
        #rValueDisplay { color: #007bff; min-width: 30px; display: inline-block; }
    </style>
</head>
<body>
    <h2>Ï†ïÎ∞Ä Í≥ÑÏÇ∞Í∏∞ & Îß§Í∞úÎ≥ÄÏàò Í∑∏ÎûòÌîÑ</h2>
    <div class="calculator">
        <div id="display" contenteditable="true" spellcheck="false">y = r * sin(x)</div>
        <div class="buttons">
            <button class="clear" onclick="clearDisplay()">C</button>
            <button class="delete" onclick="deleteLast()">‚å´</button>
            <button onclick="appendValue('(')">(</button>
            <button onclick="appendValue(')')">)</button>
            <button onclick="appendValue('PI')">œÄ</button>
            <button onclick="appendValue('7')">7</button>
            <button onclick="appendValue('8')">8</button>
            <button onclick="appendValue('9')">9</button>
            <button onclick="appendValue('+')">+</button>
            <button onclick="appendValue('-')">¬±</button>
            <button onclick="appendValue('4')">4</button>
            <button onclick="appendValue('5')">5</button>
            <button onclick="appendValue('6')">6</button>
            <button onclick="appendValue('-')">-</button>
            <button onclick="appendValue('sqrt(')">‚àö</button>
            <button onclick="appendValue('1')">1</button>
            <button onclick="appendValue('2')">2</button>
            <button onclick="appendValue('3')">3</button>
            <button onclick="appendValue('*')">*</button>
            <button onclick="appendValue('pow(')" style="background:#d4edda;">^</button>
            <button onclick="appendValue('0')">0</button>
            <button onclick="appendValue('/')">/</button>
            <button class="equal" onclick="calculate()">=</button>
            <button onclick="appendValue('sin(')">sin</button>
            <button onclick="appendValue('cos(')">cos</button>
            <button onclick="appendValue('tan(')">tan</button>
            <button onclick="appendValue('atan(')">atan</button>
            <button onclick="appendValue('acos(')">acos</button>
            <button onclick="appendValue('asin(')">asin</button>
            <button onclick="appendValue('log(')">log</button>
            <button onclick="drawGraph(getDisplayText())" style="background:#fff3cd;">üìà</button>
            <button onclick="appendValue('.')">.</button>
            <button class="var-btn" onclick="appendValue('x')">x</button>
            <button class="var-btn" onclick="appendValue('y')">y</button> 
            <button class="var-btn" onclick="appendValue('t')">t</button>
            <button class="var-btn" onclick="appendValue('r')">r</button>
            <button class="var-btn" onclick="appendValue(' | ')">|</button>
            <button onclick="appendValue('=')">=</button>
        </div>
    </div>

    <div class="controls">
        <label>ÏÉÅÏàò r Ï°∞Ï†à:</label>
        <input type="range" id="rSlider" min="-10" max="10" step="0.1" value="1" oninput="updateR(this.value)">
        <span id="rValueDisplay">1</span>
    </div>

    <div class="canvas-container">
        <canvas id="graphCanvas" width="700" height="700"></canvas>
        <div class="result" id="resultValue">Í≤∞Í≥ºÍ∞í: </div>
    </div>

    <script>
        const canvas = document.getElementById("graphCanvas");
        const ctx = canvas.getContext("2d");
        const display = document.getElementById("display");
        let offsetX = canvas.width / 2, offsetY = canvas.height / 2;
        let isDragging = false, lastMouseX, lastMouseY, scale = 50, range = 500;
        let currentR = 1; // ÏÉÅÏàò r Ï¥àÍ∏∞Í∞í

        const mathScope = { sin: Math.sin, cos: Math.cos, tan: Math.tan, asin: Math.asin, acos: Math.acos, atan: Math.atan, sqrt: Math.sqrt, pow: Math.pow, log: Math.log, exp: Math.exp, PI: Math.PI, E: Math.E };

        function updateR(val) {
            currentR = parseFloat(val);
            document.getElementById('rValueDisplay').innerText = val;
            drawGraph(getDisplayText());
        }

        function appendValue(v) { display.focus(); document.execCommand('insertText', false, v); }
        function clearDisplay() { display.innerText = ''; document.getElementById('resultValue').innerText = "Í≤∞Í≥ºÍ∞í: "; }
        function deleteLast() { display.innerText = display.innerText.slice(0, -1); }
        function getDisplayText() { return display.innerText.replace(/\n/g, ""); }

        function calculate() {
            try {
                let expr = getDisplayText();
                if (!expr.includes('x') && !expr.includes('t') && !expr.includes('y')) {
                    const res = new Function("r", ...Object.keys(mathScope), "return " + expr)(currentR, ...Object.values(mathScope));
                    document.getElementById('resultValue').innerText = "Í≤∞Í≥ºÍ∞í: " + res;
                }
                drawGraph(expr);
            } catch (e) { console.log(e); }
        }

        function drawGraph(expression) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = 1;
            for (let i = -range; i <= range; i++) {
                ctx.strokeStyle = (i === 0) ? "#333" : "#eee";
                ctx.beginPath(); ctx.moveTo(offsetX + i * scale, 0); ctx.lineTo(offsetX + i * scale, canvas.height);
                ctx.moveTo(0, offsetY + i * scale); ctx.lineTo(canvas.width, offsetY + i * scale); ctx.stroke();
                if (i !== 0 && i % 5 === 0) { ctx.fillStyle = "#888"; ctx.font = "10px Arial"; ctx.fillText(i, offsetX + i * scale + 2, offsetY - 5); ctx.fillText(-i, offsetX + 5, offsetY + i * scale - 2); }
            }
            if (!expression || expression.trim() === "") return;
            const keys = Object.keys(mathScope), values = Object.values(mathScope);

            if (expression.includes('|')) {
                let parts = expression.split('|');
                let exprX = parts[0].trim(), exprY = parts[1] ? parts[1].trim() : exprX;
                ctx.strokeStyle = "magenta"; ctx.lineWidth = 2.5; ctx.beginPath();
                for (let t = 0; t <= Math.PI * 12; t += 0.01) {
                    const xVal = new Function("t", "r", ...keys, "return " + exprX)(t, currentR, ...values);
                    const yVal = new Function("t", "r", ...keys, "return " + exprY)(t, currentR, ...values);
                    if (t === 0) ctx.moveTo(offsetX + xVal * scale, offsetY - yVal * scale); else ctx.lineTo(offsetX + xVal * scale, offsetY - yVal * scale);
                }
                ctx.stroke();
            } else if (expression.includes('=') && !expression.trim().startsWith('y=')) {
                let parts = expression.split('=');
                let implicitExpr = `(${parts[0].trim()}) - (${parts[1].trim()})`;
                const res = 2; ctx.strokeStyle = "magenta"; ctx.lineWidth = 2;
                const f = (vx, vy) => { try { return new Function("x", "y", "r", ...keys, "return " + implicitExpr)(vx, vy, currentR, ...values); } catch (e) { return 0; } };
                for (let px = 0; px < canvas.width; px += res) {
                    for (let py = 0; py < canvas.height; py += res) {
                        const x0 = (px - offsetX) / scale, y0 = (offsetY - py) / scale;
                        const x1 = (px + res - offsetX) / scale, y1 = (offsetY - (py + res)) / scale;
                        const v1 = f(x0, y0), v2 = f(x1, y0), v3 = f(x1, y1), v4 = f(x0, y1);
                        let code = 0; if (v1 > 0) code |= 8; if (v2 > 0) code |= 4; if (v3 > 0) code |= 2; if (v4 > 0) code |= 1;
                        if (code === 0 || code === 15) continue;
                        const getI = (a, b, p1, p2) => p1 + (Math.abs(a) / (Math.abs(a) + Math.abs(b))) * (p2 - p1);
                        ctx.beginPath();
                        const t = getI(v1, v2, px, px + res), b = getI(v4, v3, px, px + res), l = getI(v1, v4, py, py + res), r = getI(v2, v3, py, py + res);
                        if (code === 1 || code === 14) { ctx.moveTo(px, l); ctx.lineTo(b, py + res); }
                        else if (code === 2 || code === 13) { ctx.moveTo(px + res, r); ctx.lineTo(b, py + res); }
                        else if (code === 3 || code === 12) { ctx.moveTo(px, l); ctx.lineTo(px + res, r); }
                        else if (code === 4 || code === 11) { ctx.moveTo(px + res, r); ctx.lineTo(t, py); }
                        else if (code === 6 || code === 9) { ctx.moveTo(t, py); ctx.lineTo(b, py + res); }
                        else if (code === 7 || code === 8) { ctx.moveTo(px, l); ctx.lineTo(t, py); }
                        else if (code === 10) { ctx.moveTo(px, l); ctx.lineTo(b, py + res); ctx.moveTo(px + res, r); ctx.lineTo(t, py); }
                        ctx.stroke();
                    }
                }
            } else {
                let cleanExpr = expression;
                if (expression.includes('=')) cleanExpr = expression.split('=')[1].trim();
                ctx.strokeStyle = "magenta"; ctx.lineWidth = 2.5; ctx.beginPath();
                let first = true;
                for (let x = -range / scale; x <= range / scale; x += 0.02) {
                    try {
                        const yVal = new Function("x", "r", ...keys, "return " + cleanExpr)(x, currentR, ...values);
                        if (first) { ctx.moveTo(offsetX + x * scale, offsetY - yVal * scale); first = false; } else { ctx.lineTo(offsetX + x * scale, offsetY - yVal * scale); }
                    } catch (e) {}
                }
                ctx.stroke();
            }
        }
        canvas.addEventListener("mousedown", (e) => { isDragging = true; lastMouseX = e.clientX; lastMouseY = e.clientY; canvas.style.cursor = "grabbing"; });
        window.addEventListener("mousemove", (e) => { if (isDragging) { offsetX += e.clientX - lastMouseX; offsetY += e.clientY - lastMouseY; lastMouseX = e.clientX; lastMouseY = e.clientY; drawGraph(getDisplayText()); } });
        window.addEventListener("mouseup", () => { isDragging = false; canvas.style.cursor = "grab"; });
        canvas.addEventListener("wheel", (e) => { e.preventDefault(); scale *= (e.deltaY < 0 ? 1.1 : 0.9); drawGraph(getDisplayText()); });
        drawGraph(getDisplayText());
    </script>
</body>
</html>